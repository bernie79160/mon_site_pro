<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de fichiers - Arborescence Dynamique</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        .win-explorer {
            display: flex;
            flex-direction: column;
            height: 600px;
            border: 1px solid #d1d1d1;
            border-radius: 5px;
            background: white;
            overflow: hidden;
            position: relative; /* Pour positionner la modale par rapport √† l'explorateur */
        }

        .explorer-main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: #f9f9f9;
            border-right: 1px solid #d1d1d1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .tree-item {
            padding: 6px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .tree-item:hover { background: #ebebeb; }
        
        .tree-item.active { 
            background: #cce4f7; 
            color: #0078d4; 
            font-weight: bold; 
        }

        .sub-tree {
            margin-left: 18px;
            border-left: 1px dotted #bbb;
            display: block;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            background: #ffffff;
            overflow-y: auto;
        }

        .explorer-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            padding: 10px;
            background: #f3f3f3;
            border-bottom: 1px solid #d1d1d1;
        }

        .btn-corrige {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn-corrige:hover { background: #c0392b; }

        .btn-card {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .dropdown-item {
            padding: 8px 15px;
            cursor: pointer;
        }
        .dropdown-item:hover { background: #f0f0f0; }

        .folder-item {
            display: inline-block;
            cursor: pointer;
            text-align: center;
            padding: 10px;
            width: 80px;
            margin: 5px;
        }
        .folder-item:hover { background: #f0f0f0; border-radius: 4px; }
        
        .address-bar {
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 4px;
            font-size: 0.9rem;
            min-width: 200px;
        }

        /* --- STYLES FEN√äTRE MODALE --- */
        .modal-overlay {
            display: none; /* Cach√© par d√©faut */
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .modal-box h3 { margin-top: 0; }

        .modal-box input {
            width: 80%;
            padding: 8px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .modal-box button {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin: 0 5px;
        }
        
        .btn-confirm { background: #2ecc71; color: white; }
        .btn-cancel { background: #ccc; color: #333; }
    </style>
</head>
<body class="page-cours">

    <header>
        <nav><ul><li><a href="index.html"><i class="fas fa-arrow-left"></i> Quitter le cours</a></li></ul></nav>
    </header>

    <main class="contenu-cours">
        <div id="box-instruction" class="entete-cours" style="background: white; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
            <h2 id="titre-mission"><i class="fas fa-tasks"></i> Mission : L'Arborescence</h2>
            <p id="texte-instruction" class="consigne-majeure">Cliquez sur un dossier √† gauche pour commencer l'organisation.</p>
            <button id="btn-valider-exercice" class="btn-card" style="display:none; background-color: #2ecc71;" onclick="validerCoursExplorateur()">Terminer l'exercice</button>
        </div>

        <div class="win-explorer">
            <div id="modal-nouveau" class="modal-overlay">
                <div class="modal-box">
                    <h3><i class="fas fa-folder-plus" style="color:#ffca28"></i> Nouveau Dossier</h3>
                    <p>Nom du dossier :</p>
                    <input type="text" id="modal-input" placeholder="ex: Factures">
                    <br>
                    <button class="btn-cancel" onclick="fermerModale()">Annuler</button>
                    <button class="btn-confirm" onclick="validerCreationModal()">Cr√©er</button>
                </div>
            </div>

            <div class="explorer-toolbar">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div style="position: relative;">
                        <button class="btn-card" style="margin:0;" id="btn-nouveau" onclick="toggleMenuNouveau()">
                            <i class="fas fa-plus" style="color:#2ecc71"></i> Nouveau
                        </button>
                        <div id="menu-nouveau" class="dropdown-menu">
                            <div class="dropdown-item" onclick="ouvrirModale()"><i class="fas fa-folder" style="color:#ffca28"></i> Dossier</div>
                        </div>
                    </div>
                    <div class="address-bar" id="barre-adresse"><i class="fas fa-desktop"></i> Ce PC</div>
                </div>
                <button class="btn-corrige" onclick="appliquerCorrige()"><i class="fas fa-magic"></i> Corrig√©</button>
            </div>

            <div class="explorer-main">
                <div class="sidebar" id="sidebar-tree">
                    <div id="node-Documents">
                        <div class="tree-item" id="side-Documents" onclick="ouvrirDossier('Documents')">
                            <i class="fas fa-folder" style="color:#3498db"></i> Documents
                        </div>
                        <div class="sub-tree" id="sub-Documents"></div>
                    </div>
                    <div id="node-Images">
                        <div class="tree-item" id="side-Images" onclick="ouvrirDossier('Images')">
                            <i class="fas fa-folder" style="color:#e74c3c"></i> Images
                        </div>
                        <div class="sub-tree" id="sub-Images"></div>
                    </div>
                    <div id="node-Musique">
                        <div class="tree-item" id="side-Musique" onclick="ouvrirDossier('Musique')">
                            <i class="fas fa-folder" style="color:#9b59b6"></i> Musique
                        </div>
                        <div class="sub-tree" id="sub-Musique"></div>
                    </div>
                    <div id="node-Videos">
                        <div class="tree-item" id="side-Videos" onclick="ouvrirDossier('Videos')">
                            <i class="fas fa-folder" style="color:#1abc9c"></i> Vid√©os
                        </div>
                        <div class="sub-tree" id="sub-Videos"></div>
                    </div>
                </div>

                <div class="content-area">
                    <div class="zone-fichiers" id="zone-fichiers">
                        <p style="color:#999; text-align:center; margin-top:50px;">S√©lectionnez un dossier √† gauche pour commencer.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        let dossierActuel = ""; 
        let estDansSousDossier = false;

        const objectifs = {
            "Documents": { nom: "ADMIN", fait: false, enfants: ["Factures", "Contrats"], faitsEnfants: [] },
            "Images": { nom: "SOUVENIRS", fait: false, enfants: ["2024", "2025"], faitsEnfants: [] },
            "Musique": { nom: "PLAYLIST", fait: false, enfants: ["Jazz", "Classique"], faitsEnfants: [] },
            "Videos": { nom: "FILMS", fait: false, enfants: ["Vacances", "Cinema"], faitsEnfants: [] }
        };

        function toggleMenuNouveau() {
            const menu = document.getElementById('menu-nouveau');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }

        function ouvrirDossier(nom) {
            dossierActuel = nom;
            estDansSousDossier = false;
            majInterface();
        }

        function entrerDansDossier() {
            if (!dossierActuel || !objectifs[dossierActuel].fait) return;
            estDansSousDossier = true;
            majInterface();
        }

        function majInterface() {
            document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
            
            let idBouton;
            if (estDansSousDossier) {
                idBouton = `side-sub-${objectifs[dossierActuel].nom}`;
            } else {
                idBouton = `side-${dossierActuel}`;
            }
            
            let el = document.getElementById(idBouton);
            if(el) el.classList.add('active');

            let path = `<i class="fas fa-desktop"></i> Ce PC > ${dossierActuel}`;
            if(estDansSousDossier) path += ` > ${objectifs[dossierActuel].nom}`;
            document.getElementById('barre-adresse').innerHTML = path;

            rafraichirZoneFichiers();
            majConsigneLocal();
        }

        // --- GESTION MODALE JS ---
        function ouvrirModale() {
            if (!dossierActuel) { alert("S√©lectionnez d'abord un dossier √† gauche !"); return; }
            document.getElementById('menu-nouveau').style.display = 'none';
            document.getElementById('modal-nouveau').style.display = 'flex';
            document.getElementById('modal-input').focus();
        }

        function fermerModale() {
            document.getElementById('modal-nouveau').style.display = 'none';
            document.getElementById('modal-input').value = '';
        }

        function validerCreationModal() {
            let nom = document.getElementById('modal-input').value;
            if (!nom) return;
            
            verifierObjectifDossier(nom);
            rafraichirArborescence(); 
            majInterface();
            fermerModale();
        }
        // -------------------------

        function verifierObjectifDossier(nom) {
            let obj = objectifs[dossierActuel];
            let nomTape = nom.toUpperCase().trim();
            
            if (!estDansSousDossier) {
                if (nomTape === obj.nom) {
                    obj.fait = true;
                    // alert("Parfait ! Dossier racine cr√©√©.");
                } else {
                    // alert(`Nom incorrect. Attendu : ${obj.nom}`);
                }
            } else {
                let enfantTrouve = obj.enfants.find(e => e.toUpperCase() === nomTape);
                if (enfantTrouve) {
                    if (!obj.faitsEnfants.includes(enfantTrouve)) {
                        obj.faitsEnfants.push(enfantTrouve);
                        // alert("Succ√®s ! Sous-dossier cr√©√©.");
                    } else {
                        // alert("Ce dossier existe d√©j√†.");
                    }
                } else {
                    // alert(`Nom incorrect. Attendu : ${obj.enfants.join(' ou ')}`);
                }
            }
        }

        function rafraichirArborescence() {
            Object.keys(objectifs).forEach(key => {
                const container = document.getElementById(`sub-${key}`);
                container.innerHTML = ""; 
                
                let obj = objectifs[key];
                if (obj.fait) {
                    container.innerHTML += `
                        <div class="tree-item" id="side-sub-${obj.nom}" onclick="ouvrirDossier('${key}'); entrerDansDossier();">
                            <i class="fas fa-folder-open" style="color:#ffca28"></i> ${obj.nom}
                        </div>
                        <div class="sub-tree" id="deep-${key}"></div>
                    `;

                    const deepContainer = document.getElementById(`deep-${key}`);
                    obj.faitsEnfants.forEach(enfant => {
                        deepContainer.innerHTML += `
                            <div class="tree-item" style="opacity:0.7; cursor:default; padding-left: 30px;">
                                <i class="fas fa-folder" style="font-size:12px; color:#ffca28;"></i> ${enfant}
                            </div>
                        `;
                    });
                }
            });
        }

        function rafraichirZoneFichiers() {
            const zone = document.getElementById('zone-fichiers');
            zone.innerHTML = "";
            let obj = objectifs[dossierActuel];
            if(!obj) return;

            if (!estDansSousDossier) {
                if (obj.fait) {
                    zone.innerHTML += `
                        <div class="folder-item" ondblclick="entrerDansDossier()">
                            <i class="fas fa-folder" style="color:#ffca28; font-size:3rem;"></i><br>
                            <span style="font-size:0.9rem;">${obj.nom}</span>
                        </div>`;
                }
            } else {
                obj.faitsEnfants.forEach(e => {
                    zone.innerHTML += `
                        <div class="folder-item">
                            <i class="fas fa-folder" style="color:#ffca28; font-size:3rem;"></i><br>
                            <span style="font-size:0.9rem;">${e}</span>
                        </div>`;
                });
            }
        }

        function majConsigneLocal() {
            const txt = document.getElementById('texte-instruction');
            if(!dossierActuel) return;
            let obj = objectifs[dossierActuel];
            
            if (!obj.fait) {
                txt.innerHTML = `Dans <strong>${dossierActuel}</strong>, cr√©ez le dossier : <strong>${obj.nom}</strong>`;
            } else if (obj.faitsEnfants.length < obj.enfants.length) {
                if(!estDansSousDossier) {
                    txt.innerHTML = `Bravo ! <strong>Double-cliquez</strong> sur <strong>${obj.nom}</strong> au centre pour entrer dedans.`;
                } else {
                    let manquants = obj.enfants.filter(e => !obj.faitsEnfants.includes(e));
                    txt.innerHTML = `Super ! Cr√©ez maintenant : <strong>${manquants.join(' et ')}</strong>`;
                }
            } else {
                txt.innerHTML = `Dossier ${dossierActuel} termin√© ! S√©lectionnez un autre dossier √† gauche.`;
                
                if (Object.values(objectifs).every(o => o.faitsEnfants.length >= o.enfants.length)) {
                    txt.innerHTML = "üéâ F√©licitations Bernard ! L'arborescence est compl√®te.";
                    document.getElementById('btn-valider-exercice').style.display = "block";
                }
            }
        }

        function appliquerCorrige() {
            Object.keys(objectifs).forEach(key => {
                let obj = objectifs[key];
                obj.fait = true;
                obj.faitsEnfants = [...obj.enfants];
            });
            rafraichirArborescence();
            if(dossierActuel) majInterface();
            
            document.getElementById('texte-instruction').innerHTML = "üéâ F√©licitations Bernard ! L'arborescence est compl√®te (Corrig√©).";
            document.getElementById('btn-valider-exercice').style.display = "block";
            
            // alert("Le corrig√© a √©t√© appliqu√© ! Tous les dossiers ont √©t√© cr√©√©s.");
        }

        majInterface();
    </script>
</body>

</html>
