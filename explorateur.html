<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de fichiers - Arborescence Dynamique</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .win-explorer {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .explorer-main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: #f9f9f9;
            border-right: 1px solid #d1d1d1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .tree-item {
            padding: 6px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .tree-item:hover { background: #ebebeb; }
        
        .tree-item.active { 
            background: #cce4f7; 
            color: #0078d4; 
            font-weight: bold; 
        }

        .sub-tree {
            margin-left: 18px;
            border-left: 1px dotted #bbb;
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-5px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .content-area {
            flex: 1;
            padding: 20px;
            background: #ffffff;
            overflow-y: auto;
        }

        .explorer-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            padding: 10px;
            background: #f3f3f3;
            border-bottom: 1px solid #d1d1d1;
        }

        .btn-corrige {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn-corrige:hover { background: #c0392b; }
    </style>
</head>
<body class="page-cours">

    <header>
        <nav><ul><li><a href="index.html"><i class="fas fa-arrow-left"></i> Quitter le cours</a></li></ul></nav>
    </header>

    <main class="contenu-cours">
        <div id="box-instruction" class="entete-cours">
            <h2 id="titre-mission"><i class="fas fa-tasks"></i> Mission : L'Arborescence</h2>
            <p id="texte-instruction" class="consigne-majeure">Cliquez sur un dossier √† gauche pour commencer l'organisation.</p>
            <button id="btn-valider-exercice" class="btn-cours" style="display:none;" onclick="validerCours('explorateur')">Terminer l'exercice</button>
        </div>

        <div class="win-explorer">
            <div class="explorer-toolbar">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div style="position: relative;">
                        <button class="btn-card" style="margin:0; padding: 5px 15px;" id="btn-nouveau" onclick="toggleMenuNouveau()">
                            <i class="fas fa-plus" style="color:#2ecc71"></i> Nouveau
                        </button>
                        <div id="menu-nouveau" class="dropdown-menu">
                            <div class="dropdown-item" onclick="creerElement('dossier')"><i class="fas fa-folder" style="color:#ffca28"></i> Dossier</div>
                        </div>
                    </div>
                    <div class="address-bar" id="barre-adresse"><i class="fas fa-desktop"></i> Ce PC</div>
                </div>
                <button class="btn-corrige" onclick="appliquerCorrige()"><i class="fas fa-magic"></i> Remplir automatiquement (Corrig√©)</button>
            </div>

            <div class="explorer-main">
                <div class="sidebar" id="sidebar-tree">
                    <div id="node-Documents">
                        <div class="tree-item" id="side-Documents" onclick="ouvrirDossier('Documents')">
                            <i class="fas fa-file-alt" style="color:#3498db"></i> Documents
                        </div>
                        <div class="sub-tree" id="sub-Documents"></div>
                    </div>
                    <div id="node-Images">
                        <div class="tree-item" id="side-Images" onclick="ouvrirDossier('Images')">
                            <i class="fas fa-image" style="color:#e74c3c"></i> Images
                        </div>
                        <div class="sub-tree" id="sub-Images"></div>
                    </div>
                    <div id="node-Musique">
                        <div class="tree-item" id="side-Musique" onclick="ouvrirDossier('Musique')">
                            <i class="fas fa-music" style="color:#9b59b6"></i> Musique
                        </div>
                        <div class="sub-tree" id="sub-Musique"></div>
                    </div>
                    <div id="node-Videos">
                        <div class="tree-item" id="side-Videos" onclick="ouvrirDossier('Videos')">
                            <i class="fas fa-video" style="color:#1abc9c"></i> Vid√©os
                        </div>
                        <div class="sub-tree" id="sub-Videos"></div>
                    </div>
                </div>

                <div class="content-area">
                    <div class="zone-fichiers" id="zone-fichiers">
                        <p style="color:#999; text-align:center; margin-top:50px;">S√©lectionnez un dossier √† gauche pour commencer.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let dossierActuel = ""; 
        let estDansSousDossier = false;

        // Configuration des objectifs incluant le nouveau dossier Vid√©os
        const objectifs = {
            "Documents": { nom: "ADMIN", fait: false, enfants: ["Factures", "Contrats"], faitsEnfants: [] },
            "Images": { nom: "SOUVENIRS", fait: false, enfants: ["2024", "2025"], faitsEnfants: [] },
            "Musique": { nom: "PLAYLIST", fait: false, enfants: ["Jazz", "Classique"], faitsEnfants: [] },
            "Videos": { nom: "FILMS", fait: false, enfants: ["Vacances", "Cinema"], faitsEnfants: [] }
        };

        function toggleMenuNouveau() {
            const menu = document.getElementById('menu-nouveau');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }

        function ouvrirDossier(nom) {
            dossierActuel = nom;
            estDansSousDossier = false;
            majInterface();
        }

        function entrerDansDossier() {
            if (!dossierActuel || !objectifs[dossierActuel].fait) return;
            estDansSousDossier = true;
            majInterface();
        }

        function majInterface() {
            document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
            let idBouton = estDansSousDossier ? `side-sub-${objectifs[dossierActuel].nom}` : `side-${dossierActuel}`;
            let el = document.getElementById(idBouton);
            if(el) el.classList.add('active');

            let path = `<i class="fas fa-desktop"></i> Ce PC > ${dossierActuel}`;
            if(estDansSousDossier) path += ` > ${objectifs[dossierActuel].nom}`;
            document.getElementById('barre-adresse').innerHTML = path;

            rafraichirZoneFichiers();
            majConsigneLocal();
        }

        function creerElement(type) {
            if (!dossierActuel) { alert("S√©lectionnez d'abord un dossier √† gauche !"); return; }
            let nom = prompt("Entrez le nom du nouveau dossier :");
            if (!nom) return;
            if (document.getElementById('menu-nouveau')) document.getElementById('menu-nouveau').style.display = 'none';

            verifierObjectifDossier(nom);
            rafraichirArborescence(); 
            majInterface();
        }

        function verifierObjectifDossier(nom) {
            let obj = objectifs[dossierActuel];
            let nomTape = nom.toUpperCase().trim();
            if (!estDansSousDossier) {
                if (nomTape === obj.nom) obj.fait = true;
            } else {
                if (obj.enfants.map(e => e.toUpperCase()).includes(nomTape)) {
                    if (!obj.faitsEnfants.includes(nomTape)) {
                        // On stocke le nom avec la casse d'origine du tableau objectifs pour l'esth√©tique
                        let nomCorrect = obj.enfants.find(e => e.toUpperCase() === nomTape);
                        obj.faitsEnfants.push(nomCorrect);
                    }
                }
            }
        }

        function rafraichirArborescence() {
            Object.keys(objectifs).forEach(key => {
                const container = document.getElementById(`sub-${key}`);
                container.innerHTML = ""; 
                
                let obj = objectifs[key];
                if (obj.fait) {
                    container.innerHTML += `
                        <div class="tree-item" id="side-sub-${obj.nom}" onclick="ouvrirDossier('${key}'); entrerDansDossier();">
                            <i class="fas fa-folder-open" style="color:#ffca28"></i> ${obj.nom}
                        </div>
                        <div class="sub-tree" id="deep-${key}"></div>
                    `;

                    const deepContainer = document.getElementById(`deep-${key}`);
                    obj.faitsEnfants.forEach(enfant => {
                        deepContainer.innerHTML += `
                            <div class="tree-item" style="opacity:0.7; cursor:default;">
                                <i class="fas fa-folder" style="font-size:11px;"></i> ${enfant}
                            </div>
                        `;
                    });
                }
            });
        }

        function rafraichirZoneFichiers() {
            const zone = document.getElementById('zone-fichiers');
            zone.innerHTML = "";
            let obj = objectifs[dossierActuel];
            if(!obj) return;

            if (!estDansSousDossier) {
                if (obj.fait) {
                    zone.innerHTML += `
                        <div class="folder-item" ondblclick="entrerDansDossier()">
                            <i class="fas fa-folder" style="color:#ffca28"></i>
                            <span>${obj.nom}</span>
                        </div>`;
                }
            } else {
                obj.faitsEnfants.forEach(e => {
                    zone.innerHTML += `<div class="folder-item"><i class="fas fa-folder" style="color:#ffca28"></i><span>${e}</span></div>`;
                });
            }
        }

        function majConsigneLocal() {
            const txt = document.getElementById('texte-instruction');
            if(!dossierActuel) return;
            let obj = objectifs[dossierActuel];
            
            if (!obj.fait) {
                txt.innerHTML = `Dans ${dossierActuel}, cr√©ez le dossier <strong>${obj.nom}</strong>.`;
            } else if (obj.faitsEnfants.length < obj.enfants.length) {
                if(!estDansSousDossier) txt.innerHTML = `Bravo ! Maintenant, <strong>double-cliquez</strong> sur ${obj.nom} au centre pour entrer dedans.`;
                else txt.innerHTML = `Super ! Cr√©ez maintenant les dossiers : <strong>${obj.enfants.join(' et ')}</strong>`;
            } else {
                txt.innerHTML = `Dossier ${dossierActuel} termin√© ! Passez au suivant √† gauche.`;
                
                // V√©rification finale
                if (Object.values(objectifs).every(o => o.faitsEnfants.length >= o.enfants.length)) {
                    txt.innerHTML = "üéâ F√©licitations Bernard ! L'arborescence est compl√®te.";
                    document.getElementById('btn-valider-exercice').style.display = "block";
                }
            }
        }

        // --- FONCTION CORRIG√â ---
        function appliquerCorrige() {
            Object.keys(objectifs).forEach(key => {
                let obj = objectifs[key];
                obj.fait = true;
                obj.faitsEnfants = [...obj.enfants];
            });
            rafraichirArborescence();
            if(dossierActuel) majInterface();
            majConsigneLocal();
            alert("Le corrig√© a √©t√© appliqu√© ! Tous les dossiers ont √©t√© cr√©√©s.");
        }
    </script>
</body>
</html>